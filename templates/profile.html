{% extends "base.html" %}

{% block content %}
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<div class="container">
    <h2>My Profile</h2>
    
    <div class="profile-section">
        <div class="profile-picture-container">
            {% if user.profile_picture %}
                <img src="{{ url_for('static', filename=user.profile_picture) }}" alt="Profile Picture" class="profile-picture">
            {% else %}
                <div class="profile-picture-placeholder">
                    <i class="fas fa-user-circle"></i>
                </div>
            {% endif %}
            
            <form method="POST" enctype="multipart/form-data" class="profile-picture-form">
                <input type="file" name="profile_picture" id="profile_picture" accept="image/*" style="display: none;">
                <label for="profile_picture" class="btn btn-primary">Change Photo</label>
                <button type="submit" class="btn btn-success">Save Changes</button>
            </form>
        </div>
        
        <div class="profile-details">
            <form method="POST">
                <div class="form-group">
                    <label for="username">Username</label>
                    <input type="text" id="username" name="username" value="{{ user.username }}" required>
                </div>
                
                <div class="form-group">
                    <label for="email">Email</label>
                    <input type="email" id="email" name="email" value="{{ user.email }}" required>
                </div>
                
                <div class="form-group">
                    <label for="role">Role</label>
                    <input type="text" id="role" value="{{ user.role }}" readonly>
                </div>
                
                <h3>Change Password</h3>
                <div class="form-group">
                    <label for="current_password">Current Password</label>
                    <input type="password" id="current_password" name="current_password">
                </div>
                
                <div class="form-group">
                    <label for="new_password">New Password</label>
                    <input type="password" id="new_password" name="new_password">
                </div>
                
                <div class="form-group">
                    <label for="confirm_password">Confirm New Password</label>
                    <input type="password" id="confirm_password" name="confirm_password">
                </div>
                
                <button type="submit" class="btn btn-primary">Update Profile</button>
            </form>
        </div>
    </div>
</div>

<script>
document.getElementById('profile_picture').addEventListener('change', function(event) {
    const file = event.target.files[0];
    if (file && file.type.startsWith('image/')) {
        const reader = new FileReader();
        reader.onload = function(e) {
            let container = document.querySelector('.profile-picture-container');
            let placeholder = container.querySelector('.profile-picture-placeholder');
            let existingImg = container.querySelector('img.profile-picture');

            if (existingImg) {
                // Update existing image
                existingImg.src = e.target.result;
            } else if (placeholder) {
                // Replace placeholder with actual image
                const img = document.createElement('img');
                img.src = e.target.result;
                img.className = 'profile-picture';
                placeholder.replaceWith(img);
            }
        };
        reader.readAsDataURL(file);
    } else {
        alert("Please select a valid image file.");
    }
});
</script>

<style>
.profile-section {
    display: flex;
    gap: 2rem;
    margin-top: 2rem;
}

.profile-picture-container {
    flex: 0 0 250px;
    text-align: center;
}

.profile-picture {
    width: 200px;
    height: 200px;
    border-radius: 50%;
    object-fit: cover;
    border: 3px solid #ddd;
}

.profile-picture-placeholder {
    width: 200px;
    height: 200px;
    border-radius: 50%;
    background-color: #f0f0f0;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 100px;
    color: #ccc;
    border: 3px solid #ddd;
}

.profile-details {
    flex: 1;
}

.profile-picture-form {
    margin-top: 1rem;
}

@media (min-width: 320px) and (max-width: 480px) {
    .profile-section {
        flex-direction: column;
    }
}
</style>
{% endblock %}