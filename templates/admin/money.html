
{% extends "base.html" %}

{% block content %}
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<div class="money-management-container">
    <div class="header">
        <h1><i class="fas fa-money-bill-wave"></i> Money Management</h1>
        <div class="current-date">
            <span id="current-date"></span>
        </div>
    </div>

    <div id="alert-container">
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    <div class="alert alert-{{ category }}">
                        {{ message }}
                        <button class="close-alert">&times;</button>
                    </div>
                {% endfor %}
            {% endif %}
        {% endwith %}
    </div>

    <div class="summary-cards">
        <div class="summary-card income">
            <h3>Total Income</h3>
            <div class="amount" id="total-income">Ksh 0.00</div>
            <p>All time income</p>
        </div>
        <div class="summary-card expenses">
            <h3>Total Expenses</h3>
            <div class="amount" id="total-expenses">Ksh 0.00</div>
            <p>All time expenses</p>
        </div>
        <div class="summary-card profit">
            <h3>Net Profit</h3>
            <div class="amount" id="net-profit">Ksh 0.00</div>
            <p>Income minus expenses</p>
        </div>
        <div class="summary-card pending">
            <h3>Pending Payments</h3>
            <div class="amount" id="pending-payments">0</div>
            <p>Bills and payroll due</p>
        </div>
    </div>

    <div class="tabs">
        <div class="tab active" data-tab="drawings">Drawings</div>
        <div class="tab" data-tab="bills">Bills</div>
        <div class="tab" data-tab="purchases">Purchases</div>
        <div class="tab" data-tab="payroll">Payroll</div>
        <div class="tab" data-tab="debtors">Debtors</div>
    </div>

    <!-- Drawings Tab -->
    <div class="tab-content active" id="drawings-tab">
        <div class="section-header">
            <h2><i class="fas fa-hand-holding-usd"></i> Owner's Drawings</h2>
            <button class="btn btn-primary" data-modal-target="add-drawing">
                <i class="fas fa-plus"></i> Add Drawing
            </button>
        </div>
        <div class="table-responsive">
            <table id="drawings-table">
                <thead>
                    <tr>
                        <th>Date</th>
                        <th>Amount</th>
                        <th>Description</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for drawing in drawings %}
                    <tr>
                        <td>{{ drawing.created_at.strftime('%Y-%m-%d') }}</td>
                        <td>Ksh {{ "%.2f"|format(drawing.amount) }}</td>
                        <td>{{ drawing.notes.replace("Owner's drawing: ", "") }}</td>
                        <td class="action-btns">
                            <button class="action-btn btn-primary" 
                                    onclick="moneyManagement.editDrawing({{ drawing.id }}, {{ drawing.amount }}, '{{ drawing.notes.replace("Owner's drawing: ", "") | replace("'", "\\'") }}')">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="action-btn btn-danger" 
                                    data-delete-record="{{ drawing.id }}" 
                                    data-record-type="drawing">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            {% if not drawings %}
            <div class="empty-state" id="drawings-empty">
                <i class="fas fa-money-bill-wave"></i>
                <p>No drawings recorded yet</p>
            </div>
            {% endif %}
        </div>
    </div>

    <!-- Bills Tab -->
    <div class="tab-content" id="bills-tab">
        <div class="section-header">
            <h2><i class="fas fa-file-invoice-dollar"></i> Bills & Expenses</h2>
            <button class="btn btn-primary" data-modal-target="add-bill">
                <i class="fas fa-plus"></i> Add Bill
            </button>
        </div>
        <div class="table-responsive">
            <table id="bills-table">
                <thead>
                    <tr>
                        <th>Bill Type</th>
                        <th>Amount</th>
                        <th>Due Date</th>
                        <th>Status</th>
                        <th>Description</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for bill in expenses %}
                    <tr>
                        <td>{{ bill.expense_type }}</td>
                        <td>Ksh {{ "%.2f"|format(bill.amount) }}</td>
                        <td>{{ bill.due_date.strftime('%Y-%m-%d') }}</td>
                        <td class="{% if bill.status == 'paid' %}status-paid{% else %}status-pending{% endif %}">
                            {% if bill.status == 'paid' %}Paid{% else %}{% if bill.due_date < current_date %}Overdue{% else %}Pending{% endif %}{% endif %}
                        </td>
                        <td>{{ bill.description }}</td>
                        <td class="action-btns">
                            {% if bill.status == 'pending' %}
                            <button class="action-btn btn-success" 
                                    onclick="moneyManagement.payBill({{ bill.id }}, '{{ bill.expense_type }}', {{ bill.amount }})">
                                <i class="fas fa-money-bill-wave"></i>
                            </button>
                            {% endif %}
                            <button class="action-btn btn-primary" 
                                    onclick="moneyManagement.editBill({{ bill.id }}, '{{ bill.expense_type }}', {{ bill.amount }}, '{{ bill.due_date.strftime('%Y-%m-%d') }}', '{{ bill.description | replace("'", "\\'") }}')">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="action-btn btn-danger" 
                                    data-delete-record="{{ bill.id }}" 
                                    data-record-type="bill">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            {% if not expenses %}
            <div class="empty-state" id="bills-empty">
                <i class="fas fa-file-invoice"></i>
                <p>No bills recorded yet</p>
            </div>
            {% endif %}
        </div>
    </div>

    <!-- Purchases Tab -->
    <div class="tab-content" id="purchases-tab">
        <div class="section-header">
            <h2><i class="fas fa-shopping-cart"></i> Purchases</h2>
            <button class="btn btn-primary" data-modal-target="add-purchase">
                <i class="fas fa-plus"></i> Add Purchase
            </button>
        </div>
        <div class="table-responsive">
            <table id="purchases-table">
                <thead>
                    <tr>
                        <th>Purchase Type</th>
                        <th>Amount</th>
                        <th>Date</th>
                        <th>Supplier</th>
                        <th>Description</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for purchase in purchases %}
                    <tr>
                        <td>{{ purchase.purchase_type }}</td>
                        <td>Ksh {{ "%.2f"|format(purchase.amount) }}</td>
                        <td>{{ purchase.purchase_date.strftime('%Y-%m-%d') }}</td>
                        <td>{{ purchase.supplier }}</td>
                        <td>{{ purchase.description }}</td>
                        <td class="action-btns">
                            <button class="action-btn btn-primary" 
                                    onclick="moneyManagement.editPurchase({{ purchase.id }}, '{{ purchase.purchase_type }}', {{ purchase.amount }}, '{{ purchase.purchase_date.strftime('%Y-%m-%d') }}', '{{ purchase.supplier | replace("'", "\\'") }}', '{{ purchase.description | replace("'", "\\'") }}')">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="action-btn btn-danger" 
                                    data-delete-record="{{ purchase.id }}" 
                                    data-record-type="purchase">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            {% if not purchases %}
            <div class="empty-state" id="purchases-empty">
                <i class="fas fa-cart-plus"></i>
                <p>No purchases recorded yet</p>
            </div>
            {% endif %}
        </div>
    </div>

    <!-- Payroll Tab -->
    <div class="tab-content" id="payroll-tab">
        <div class="section-header">
            <h2><i class="fas fa-user-tie"></i> Payroll</h2>
            <button class="btn btn-primary" data-modal-target="add-payroll">
                <i class="fas fa-plus"></i> Add Payroll
            </button>
        </div>
        <div class="table-responsive">
            <table id="payroll-table">
                <thead>
                    <tr>
                        <th>Employee</th>
                        <th>Amount</th>
                        <th>Payment Date</th>
                        <th>Pay Period</th>
                        <th>Notes</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for pr in payroll %}
                    {% set employee = employees|selectattr("id", "equalto", pr.employee_id)|first %}
                    <tr>
                        <td>{{ employee.name if employee else 'Unknown' }}</td>
                        <td>Ksh {{ "%.2f"|format(pr.amount) }}</td>
                        <td>{{ pr.payment_date.strftime('%Y-%m-%d') }}</td>
                        <td>{{ pr.pay_period }}</td>
                        <td>{{ pr.notes }}</td>
                        <td class="action-btns">
                            <button class="action-btn btn-primary" 
                                    onclick="moneyManagement.editPayroll({{ pr.id }}, {{ pr.employee_id }}, {{ pr.amount }}, '{{ pr.payment_date.strftime('%Y-%m-%d') }}', '{{ pr.pay_period }}', '{{ pr.notes | replace("'", "\\'") }}')">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="action-btn btn-danger" 
                                    data-delete-record="{{ pr.id }}" 
                                    data-record-type="payroll">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            {% if not payroll %}
            <div class="empty-state" id="payroll-empty">
                <i class="fas fa-users"></i>
                <p>No payroll records yet</p>
            </div>
            {% endif %}
        </div>
    </div>

    <!-- Debtors Tab -->
<div class="tab-content" id="debtors-tab">
    <div class="section-header">
        <h2><i class="fas fa-hand-holding-usd"></i> Debtors</h2>
        <button class="btn btn-primary" data-modal-target="add-debtor">
            <i class="fas fa-plus"></i> Add Debtor
        </button>
    </div>
    <div class="table-responsive">
        <table id="debtors-table">
            <thead>
                <tr>
                    <th>Name</th>
                    <th>Contact</th>
                    <th>Total Debt</th>
                    <th>Amount Paid</th>
                    <th>Amount Owed</th>
                    <th>Last Payment</th>
                    <th>Next Payment</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for debtor in debtors %}
                <tr>
                    <td>{{ debtor.name }}</td>
                    <td>{{ debtor.contact }}</td>
                    <td>Ksh {{ "%.2f"|format(debtor.Total_debt) }}</td>
                    <td>Ksh {{ "%.2f"|format(debtor.amount_paid) }}</td>
                    <td>Ksh {{ "%.2f"|format(debtor.amount_owed) }}</td>
                    <td>{{ debtor.last_payment_date.strftime('%Y-%m-%d') if debtor.last_payment_date else 'Never' }}</td>
                    <td class="{% if debtor.next_payment_date and debtor.next_payment_date <= current_date %}status-pending{% endif %}">
                        {{ debtor.next_payment_date.strftime('%Y-%m-%d') if debtor.next_payment_date else 'N/A' }}
                    </td>
                    <td class="action-btns">
                        <button class="action-btn btn-success" 
                                onclick="moneyManagement.addDebtorPayment({{ debtor.id }}, '{{ debtor.name | replace("'", "\\'") }}', {{ debtor.Total_debt }}, {{ debtor.amount_paid }}, {{ debtor.amount_owed }}, '{{ debtor.next_payment_date.strftime('%Y-%m-%d') if debtor.next_payment_date else '' }}')">
                            <i class="fas fa-money-bill-wave"></i>
                        </button>
                        <button class="action-btn btn-primary" 
                        onclick="moneyManagement.editDebtor({{ debtor.id }}, '{{ debtor.name | replace("'", "\\'") }}', '{{ debtor.contact | replace("'", "\\'") }}', '{{ debtor.email | replace("'", "\\'") }}', {{ debtor.Total_debt }}, {{ debtor.amount_paid }}, {{ debtor.amount_owed }}, '{{ debtor.last_payment_date.strftime('%Y-%m-%d') if debtor.last_payment_date else '' }}', '{{ debtor.next_payment_date.strftime('%Y-%m-%d') if debtor.next_payment_date else '' }}', '{{ debtor.notes | replace("'", "\\'") if debtor.notes else '' }}')">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="action-btn btn-danger" 
                                data-delete-record="{{ debtor.id }}" 
                                data-record-type="debtor">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {% if not debtors %}
        <div class="empty-state" id="debtors-empty">
            <i class="fas fa-user-times"></i>
            <p>No debtors recorded yet</p>
        </div>
        {% endif %}
    </div>
</div>

<!-- Include all modals -->
<div class="modal" id="add-drawing-modal" role="dialog" aria-modal="true" aria-labelledby="add-drawing-title">
    <div class="modal-content">
        <div class="modal-header">
            <h2 id="add-drawing-title">Add Owner's Drawing</h2>
            <button class="close-btn" data-modal-target="add-drawing">&times;</button>
        </div>
        <form id="add-drawing-form" method="POST" action="/admin/add_drawing">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
            <div class="form-group">
                <label for="drawing-amount">Amount (Ksh)</label>
                <input type="number" step="0.01" id="drawing-amount" name="amount" required>
            </div>
            <div class="form-group">
                <label for="drawing-description">Description</label>
                <textarea id="drawing-description" name="description" required></textarea>
            </div>
            <div class="form-actions">
                <button type="button" class="btn" data-modal-target="add-drawing">Cancel</button>
                <button type="submit" class="btn btn-primary">Save</button>
            </div>
        </form>
    </div>
</div>

<!-- Edit Drawing Modal -->
<div class="modal" id="edit-drawing-modal" role="dialog" aria-modal="true" aria-labelledby="edit-drawing-title">
    <div class="modal-content">
        <div class="modal-header">
            <h2 id="edit-drawing-title">Edit Owner's Drawing</h2>
            <button class="close-btn" data-modal-target="edit-drawing">&times;</button>
        </div>
        <form id="edit-drawing-form" method="POST">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
            <input type="hidden" name="id" id="edit-drawing-id">
            <div class="form-group">
                <label for="edit-drawing-amount">Amount (Ksh)</label>
                <input type="number" step="0.01" id="edit-drawing-amount" name="amount" required>
            </div>
            <div class="form-group">
                <label for="edit-drawing-description">Description</label>
                <textarea id="edit-drawing-description" name="description" required></textarea>
            </div>
            <div class="form-actions">
                <button type="button" class="btn" data-modal-target="edit-drawing">Cancel</button>
                <button type="submit" class="btn btn-primary">Update</button>
            </div>
        </form>
    </div>
</div>

<!-- Add Bill Modal -->
<div class="modal" id="add-bill-modal" role="dialog" aria-modal="true" aria-labelledby="add-bill-title">
    <div class="modal-content">
        <div class="modal-header">
            <h2 id="add-bill-title">Add New Bill</h2>
            <button class="close-btn" data-modal-target="add-bill">&times;</button>
        </div>
        <form id="add-bill-form" method="POST" action="/admin/add_bill">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
            <div class="form-group">
                <label for="bill_type">Bill Type</label>
                <select id="bill_type" name="bill_type" required>
                    <option value="">Select Bill Type</option>
                    <option value="rent">Rent</option>
                    <option value="utilities">Utilities</option>
                    <option value="insurance">Insurance</option>
                    <option value="taxes">Taxes</option>
                    <option value="supplies">Supplies</option>
                    <option value="other">Other</option>
                </select>
            </div>
            <div class="form-group">
                <label for="bill-amount">Amount (Ksh)</label>
                <input type="number" step="0.01" id="bill-amount" name="amount" required>
            </div>
            <div class="form-group">
                <label for="bill-due-date">Due Date</label>
                <input type="date" id="bill-due-date" name="due_date" required>
            </div>
            <div class="form-group">
                <label for="bill-description">Description</label>
                <textarea id="bill-description" name="description"></textarea>
            </div>
            <div class="form-actions">
                <button type="button" class="btn" data-modal-target="add-bill">Cancel</button>
                <button type="submit" class="btn btn-primary">Save</button>
            </div>
        </form>
    </div>
</div>

<!-- Edit Bill Modal -->
<div class="modal" id="edit-bill-modal" role="dialog" aria-modal="true" aria-labelledby="edit-bill-title">
    <div class="modal-content">
        <div class="modal-header">
            <h2 id="edit-bill-title">Edit Bill</h2>
            <button class="close-btn" data-modal-target="edit-bill">&times;</button>
        </div>
        <form id="edit-bill-form" method="POST">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
            <input type="hidden" name="id" id="edit-bill-id">
            <div class="form-group">
                <label for="edit-bill-type">Bill Type</label>
                <select id="edit-bill-type" name="bill_type" required>
                    <option value="rent">Rent</option>
                    <option value="utilities">Utilities</option>
                    <option value="insurance">Insurance</option>
                    <option value="taxes">Taxes</option>
                    <option value="supplies">Supplies</option>
                    <option value="other">Other</option>
                </select>
            </div>
            <div class="form-group">
                <label for="edit-bill-amount">Amount (Ksh)</label>
                <input type="number" step="0.01" id="edit-bill-amount" name="amount" required>
            </div>
            <div class="form-group">
                <label for="edit-bill-due-date">Due Date</label>
                <input type="date" id="edit-bill-due-date" name="due_date" required>
            </div>
            <div class="form-group">
                <label for="edit-bill-description">Description</label>
                <textarea id="edit-bill-description" name="description"></textarea>
            </div>
            <div class="form-actions">
                <button type="button" class="btn" data-modal-target="edit-bill">Cancel</button>
                <button type="submit" class="btn btn-primary">Update</button>
            </div>
        </form>
    </div>
</div>

<!-- Pay Bill Modal -->
<div class="modal" id="pay-bill-modal" role="dialog" aria-modal="true" aria-labelledby="pay-bill-title">
    <div class="modal-content">
        <div class="modal-header">
            <h2 id="pay-bill-title">Pay Bill</h2>
            <button class="close-btn" data-modal-target="pay-bill">&times;</button>
        </div>
        <form id="pay-bill-form" method="POST">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
            <input type="hidden" name="id" id="pay-bill-id">
            <div class="form-group">
                <label>Bill Type</label>
                <p id="pay-bill-type-display"></p>
            </div>
            <div class="form-group">
                <label>Amount</label>
                <p id="pay-bill-amount-display"></p>
            </div>
            <div class="form-actions">
                <button type="button" class="btn" data-modal-target="pay-bill">Cancel</button>
                <button type="submit" class="btn btn-success">Record Payment</button>
            </div>
        </form>
    </div>
</div>

<!-- Add Purchase Modal -->
<div class="modal" id="add-purchase-modal" role="dialog" aria-modal="true" aria-labelledby="add-purchase-title">
    <div class="modal-content">
        <div class="modal-header">
            <h2 id="add-purchase-title">Add Purchase</h2>
            <button class="close-btn" data-modal-target="add-purchase">&times;</button>
        </div>
        <form id="add-purchase-form" method="POST" action="/admin/add_purchase">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
            <div class="form-group">
                <label for="purchase_type">Purchase Type</label>
                <select id="purchase_type" name="purchase_type" required>
                    <option value="">Select Purchase Type</option>
                    <option value="equipment">Equipment</option>
                    <option value="medication">Medication</option>
                    <option value="supplies">Supplies</option>
                    <option value="office">Office Supplies</option>
                    <option value="other">Other</option>
                </select>
            </div>
            <div class="form-group">
                <label for="purchase-amount">Amount (Ksh)</label>
                <input type="number" step="0.01" id="purchase-amount" name="amount" required>
            </div>
            <div class="form-group">
                <label for="purchase-date">Purchase Date</label>
                <input type="date" id="purchase-date" name="purchase_date" required>
            </div>
            <div class="form-group">
                <label for="purchase-supplier">Supplier</label>
                <input type="text" id="purchase-supplier" name="supplier" required>
            </div>
            <div class="form-group">
                <label for="purchase-description">Description</label>
                <textarea id="purchase-description" name="description"></textarea>
            </div>
            <div class="form-actions">
                <button type="button" class="btn" data-modal-target="add-purchase">Cancel</button>
                <button type="submit" class="btn btn-primary">Save</button>
            </div>
        </form>
    </div>
</div>

<!-- Edit Purchase Modal -->
<div class="modal" id="edit-purchase-modal" role="dialog" aria-modal="true" aria-labelledby="edit-purchase-title">
    <div class="modal-content">
        <div class="modal-header">
            <h2 id="edit-purchase-title">Edit Purchase</h2>
            <button class="close-btn" data-modal-target="edit-purchase">&times;</button>
        </div>
        <form id="edit-purchase-form" method="POST">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
            <input type="hidden" name="id" id="edit-purchase-id">
            <div class="form-group">
                <label for="edit-purchase-type">Purchase Type</label>
                <select id="edit-purchase-type" name="purchase_type" required>
                    <option value="equipment">Equipment</option>
                    <option value="medication">Medication</option>
                    <option value="supplies">Supplies</option>
                    <option value="office">Office Supplies</option>
                    <option value="other">Other</option>
                </select>
            </div>
            <div class="form-group">
                <label for="edit-purchase-amount">Amount (Ksh)</label>
                <input type="number" step="0.01" id="edit-purchase-amount" name="amount" required>
            </div>
            <div class="form-group">
                <label for="edit-purchase-date">Purchase Date</label>
                <input type="date" id="edit-purchase-date" name="purchase_date" required>
            </div>
            <div class="form-group">
                <label for="edit-purchase-supplier">Supplier</label>
                <input type="text" id="edit-purchase-supplier" name="supplier" required>
            </div>
            <div class="form-group">
                <label for="edit-purchase-description">Description</label>
                <textarea id="edit-purchase-description" name="description"></textarea>
            </div>
            <div class="form-actions">
                <button type="button" class="btn" data-modal-target="edit-purchase">Cancel</button>
                <button type="submit" class="btn btn-primary">Update</button>
            </div>
        </form>
    </div>
</div>

<!-- Add Payroll Modal -->
<div class="modal" id="add-payroll-modal" role="dialog" aria-modal="true" aria-labelledby="add-payroll-title">
    <div class="modal-content">
        <div class="modal-header">
            <h2 id="add-payroll-title">Add Payroll Payment</h2>
            <button class="close-btn" data-modal-target="add-payroll">&times;</button>
        </div>
        <form id="add-payroll-form" onsubmit="submitPayroll(event)">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
            <div class="form-group">
                <label for="employee_id">Employee</label>
                <select id="employee_id" name="employee_id" required onchange="updateSalary()">
                    <option value="">Select Employee</option>
                    {% for employee in employees %}
                    <option value="{{ employee.id }}">{{ employee.name }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="form-group">
                <label for="payroll-amount">Amount (Ksh)</label>
                <input type="number" step="0.01" id="payroll-amount" name="amount" required>
            </div>
            <div class="form-group">
                <label for="payroll-payment-date">Payment Date</label>
                <input type="date" id="payroll-payment-date" name="payment_date" required>
            </div>
            <div class="form-group">
                <label for="payroll-pay-period">Pay Period</label>
                <select id="payroll-pay-period" name="pay_period" required>
                    <option value="monthly">Monthly</option>
                    <option value="biweekly">Bi-weekly</option>
                    <option value="weekly">Weekly</option>
                    <option value="daily">Daily</option>
                    <option value="other">Other</option>
                </select>
            </div>
            <div class="form-group">
                <label for="payroll-notes">Notes</label>
                <textarea id="payroll-notes" name="notes"></textarea>
            </div>
            <div class="form-group">
                <label>
                    <input type="checkbox" id="is_paid" name="is_paid">
                    Mark as Paid (will be recorded as expense)
                </label>
            </div>
            <div class="form-actions">
                <button type="button" class="btn" data-modal-target="add-payroll">Cancel</button>
                <button type="submit" class="btn btn-primary">Save</button>
            </div>
        </form>
    </div>
</div>

<!-- Edit Payroll Modal -->
<div class="modal" id="edit-payroll-modal" role="dialog" aria-modal="true" aria-labelledby="edit-payroll-title">
    <div class="modal-content">
        <div class="modal-header">
            <h2 id="edit-payroll-title">Edit Payroll Payment</h2>
            <button class="close-btn" data-modal-target="edit-payroll">&times;</button>
        </div>
        <form id="edit-payroll-form" method="POST">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
            <input type="hidden" name="id" id="edit-payroll-id">
            <div class="form-group">
                <label for="edit-payroll-employee">Employee</label>
                <select id="edit-payroll-employee" name="employee_id" required>
                    {% for employee in employees %}
                    <option value="{{ employee.id }}">{{ employee.name }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="form-group">
                <label for="edit-payroll-amount">Amount (Ksh)</label>
                <input type="number" step="0.01" id="edit-payroll-amount" name="amount" required>
            </div>
            <div class="form-group">
                <label for="edit-payroll-date">Payment Date</label>
                <input type="date" id="edit-payroll-date" name="payment_date" required>
            </div>
            <div class="form-group">
                <label for="edit-payroll-period">Pay Period</label>
                <select id="edit-payroll-period" name="pay_period" required>
                    <option value="monthly">Monthly</option>
                    <option value="biweekly">Bi-weekly</option>
                    <option value="weekly">Weekly</option>
                    <option value="daily">Daily</option>
                    <option value="other">Other</option>
                </select>
            </div>
            <div class="form-group">
                <label for="edit-payroll-notes">Notes</label>
                <textarea id="edit-payroll-notes" name="notes"></textarea>
            </div>
            <div class="form-actions">
                <button type="button" class="btn" data-modal-target="edit-payroll">Cancel</button>
                <button type="submit" class="btn btn-primary">Update</button>
            </div>
        </form>
    </div>
</div>

<!-- Add Debtor Modal -->
<div class="modal" id="add-debtor-modal" role="dialog" aria-modal="true" aria-labelledby="add-debtor-title">
    <div class="modal-content">
        <div class="modal-header">
            <h2 id="add-debtor-title">Add Debtor</h2>
            <button class="close-btn" data-modal-target="add-debtor">&times;</button>
        </div>
        <form id="add-debtor-form" method="POST" action="/admin/add_debtor">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
            <div class="form-group">
                <label for="debtor-name">Name *</label>
                <input type="text" id="debtor-name" name="name" required>
            </div>
            <div class="form-group">
                <label for="debtor-contact">Contact</label>
                <input type="text" id="debtor-contact" name="contact">
            </div>
            <div class="form-group">
                <label for="debtor-email">Email</label>
                <input type="email" id="debtor-email" name="email">
            </div>
            <div class="form-group">
                <label for="total-debt">Total Debt (Ksh) *</label>
                <input type="number" step="0.01" id="total-debt" name="total_debt" required min="0">
            </div>
            <div class="form-group">
                <label for="last-payment-date">Last Payment Date</label>
                <input type="date" id="last-payment-date" name="last_payment_date">
            </div>
            <div class="form-group">
                <label for="next-payment-date">Next Payment Date *</label>
                <input type="date" id="next-payment-date" name="next_payment_date">
            </div>
            <div class="form-group">
                <label for="debtor-notes">Notes</label>
                <textarea id="debtor-notes" name="notes"></textarea>
            </div>
            <div class="form-actions">
                <button type="button" class="btn" data-modal-target="add-debtor">Cancel</button>
                <button type="submit" class="btn btn-primary">Save</button>
            </div>
        </form>
    </div>
</div>

<!-- Edit Debtor Modal -->
<div class="modal" id="edit-debtor-modal" role="dialog" aria-modal="true" aria-labelledby="edit-debtor-title">
    <div class="modal-content">
        <div class="modal-header">
            <h2 id="edit-debtor-title">Edit Debtor</h2>
            <button class="close-btn" data-modal-target="edit-debtor">&times;</button>
        </div>
        <form id="edit-debtor-form" method="POST">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
            <input type="hidden" name="id" id="edit-debtor-id">
            <div class="form-group">
                <label for="edit-debtor-name">Name *</label>
                <input type="text" id="edit-debtor-name" name="name" required>
            </div>
            <div class="form-group">
                <label for="edit-debtor-contact">Contact</label>
                <input type="text" id="edit-debtor-contact" name="contact">
            </div>
            <div class="form-group">
                <label for="edit-debtor-email">Email</label>
                <input type="email" id="edit-debtor-email" name="email">
            </div>
            <div class="form-group">
                <label for="edit-total-debt">Total Debt (Ksh) *</label>
                <input type="number" step="0.01" id="edit-total-debt" name="total_debt" required min="0">
            </div>
            <div class="form-group">
                <label>Amount Paid (Ksh)</label>
                <p id="edit-amount-paid-display">0.00</p>
            </div>
            <div class="form-group">
                <label>Amount Owed (Ksh)</label>
                <p id="edit-amount-owed-display">0.00</p>
            </div>
            <div class="form-group">
                <label for="edit-last-payment-date">Last Payment Date</label>
                <input type="date" id="edit-last-payment-date" name="last_payment_date">
            </div>
            <div class="form-group">
                <label for="edit-next-payment-date">Next Payment Date *</label>
                <input type="date" id="edit-next-payment-date" name="next_payment_date">
            </div>
            <div class="form-group">
                <label for="edit-debtor-notes">Notes</label>
                <textarea id="edit-debtor-notes" name="notes"></textarea>
            </div>
            <div class="form-actions">
                <button type="button" class="btn" data-modal-target="edit-debtor">Cancel</button>
                <button type="submit" class="btn btn-primary">Update</button>
            </div>
        </form>
    </div>
</div>

<!-- Add Payment Modal -->
<div class="modal" id="add-debtor-payment-modal" role="dialog" aria-modal="true" aria-labelledby="add-debtor-payment-title">
    <div class="modal-content">
        <div class="modal-header">
            <h2 id="add-debtor-payment-title">Record Payment to Debtor</h2>
            <button class="close-btn" data-modal-target="add-debtor-payment">&times;</button>
        </div>
        <form id="add-debtor-payment-form" method="POST">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
            <input type="hidden" name="debtor_id" id="debtor-payment-id">
            <div class="form-group">
                <label>Debtor Name</label>
                <p id="debtor-payment-name"></p>
            </div>
            <div class="form-group">
                <label>Total Debt</label>
                <p id="debtor-total-debt-display">0.00</p>
            </div>
            <div class="form-group">
                <label>Amount Paid</label>
                <p id="debtor-amount-paid-display">0.00</p>
            </div>
            <div class="form-group">
                <label>Amount Owed</label>
                <p id="debtor-amount-owed-display">0.00</p>
            </div>
            <div class="form-group">
                <label for="payment-amount">Payment Amount (Ksh) *</label>
                <input type="number" step="0.01" id="payment-amount" name="amount" required min="0.01">
            </div>
            <div class="form-group">
                <label for="payment-date">Payment Date *</label>
                <input type="date" id="payment-date" name="payment_date" required>
            </div>
            <div class="form-group">
                <label for="payment-method">Payment Method</label>
                <select id="payment-method" name="payment_method">
                    <option value="cash">Cash</option>
                    <option value="bank">Bank Transfer</option>
                    <option value="mobile">Mobile Money</option>
                </select>
            </div>
            <div class="form-group">
                <label for="payment-notes">Notes</label>
                <textarea id="payment-notes" name="notes"></textarea>
            </div>
            <div class="form-actions">
                <button type="button" class="btn" data-modal-target="add-debtor-payment">Cancel</button>
                <button type="submit" class="btn btn-success">Record Payment</button>
            </div>
        </form>
    </div>
</div>

<!-- Delete Confirmation Modal -->
<div class="modal" id="delete-confirm-modal" role="dialog" aria-modal="true" aria-labelledby="delete-confirm-title">
    <div class="modal-content">
        <div class="modal-header">
            <h2 id="delete-confirm-title">Confirm Deletion</h2>
            <button class="close-btn" data-modal-target="delete-confirm">&times;</button>
        </div>
        <div class="modal-body">
            <p id="delete-confirm-message">Are you sure you want to delete this record?</p>
            <form id="delete-form" method="POST">
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                <input type="hidden" name="id" id="delete-record-id">
                <input type="hidden" name="type" id="delete-record-type">
            </form>
        </div>
        <div class="form-actions">
            <button type="button" class="btn" data-modal-target="delete-confirm">Cancel</button>
            <button type="button" class="btn btn-danger" id="confirm-delete-button">Delete</button>
        </div>
    </div>
</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/1.11.5/js/dataTables.bootstrap4.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"></script>

<script>
// Global object to hold all money management functions
window.moneyManagement = {
    init: function() {
        this.setCurrentDate();
        this.setupEventListeners();
        this.loadSummaryData();
        this.checkPendingPayments();
        this.initDataTables();
    },

    setCurrentDate: function() {
        const today = new Date();
        document.getElementById('current-date').textContent = today.toLocaleDateString('en-US', { 
            weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' 
        });
    },

    setupEventListeners: function() {
        // Close alert buttons
        $(document).on('click', '.close-alert', function() {
            $(this).parent().remove();
        });

        // Tab switching
        $(document).on('click', '.tab', function() {
            const tabId = $(this).data('tab');
            moneyManagement.switchTab(tabId);
        });

        // Modal handling
        $(document).on('click', '[data-modal-target]', function() {
            const modalId = $(this).data('modal-target');
            moneyManagement.openModal(modalId);
        });

        $(document).on('click', '.close-btn', function() {
            const modal = $(this).closest('.modal');
            const modalId = modal.attr('id').replace('-modal', '');
            moneyManagement.closeModal(modalId);
        });

        $(document).on('click', '.modal', function(e) {
            if (e.target === this) {
                const modalId = $(this).attr('id').replace('-modal', '');
                moneyManagement.closeModal(modalId);
            }
        });

        // Delete confirmation
        $(document).on('click', '[data-delete-record]', function() {
            const recordId = $(this).data('delete-record');
            const recordType = $(this).data('record-type');
            moneyManagement.confirmDeleteRecord(recordId, recordType);
        });

        // Confirm delete button
        $(document).on('click', '#confirm-delete-button', function() {
            moneyManagement.confirmDelete();
        });

        // Form submissions
        this.setupFormSubmissions();
    },

    refreshAllData: function() {
    // Reload the page to ensure all data is fresh
    window.location.reload();

        // Alternatively, you could implement AJAX reloading of each section:
    /*
    this.loadSummaryData();
    this.checkPendingPayments();
    this.loadDrawings();
    this.loadDebtors();
    */
    },

    setupFormSubmissions: function() {
        // Handle form submissions with AJAX
        $('form[id$="-form"]').on('submit', function(e) {
            e.preventDefault();
            const form = $(this);
            const action = form.attr('action');
            const method = form.attr('method') || 'POST';
            const formData = new FormData(this);

            fetch(action, {
                method: method,
                body: formData,
                headers: (function() {
                    const token = moneyManagement.getCSRFToken();
                    return token ? { 'X-CSRFToken': token } : {};
                })()
            })
            .then(response => response.json())
            .then(data => {
                if (data.error) {
                    moneyManagement.showAlert('danger', data.error);
                    return;
                }
                if (data.success) {
                    const modalId = form.closest('.modal').attr('id').replace('-modal', '');
                    moneyManagement.closeModal(modalId);
                    moneyManagement.showAlert('success', 'Saved successfully');
                    moneyManagement.refreshAllData();
                }
            })
            .catch(error => {
                console.error('Error:', error);
                moneyManagement.showAlert('danger', 'An error occurred. Please try again.');
            });
        });
    },

    loadSummaryData: function() {
        fetch('/admin/money/summary')
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                return response.json();
            })
            .then(data => {
                if (data.error) {
                    console.error(data.error);
                    return;
                }
                $('#total-income').text(moneyManagement.formatCurrency(data.total_income));
                $('#total-expenses').text(moneyManagement.formatCurrency(data.total_expenses));
                $('#net-profit').text(moneyManagement.formatCurrency(data.net_profit));
            })
            .catch(error => {
                console.error('Error loading summary data:', error);
            });
    },

    checkPendingPayments: function() {
        fetch('/admin/check_pending_payments')
            .then(response => response.json())
            .then(data => {
                if (data.error) {
                    console.error(data.error);
                    return;
                }
                $('#pending-payments').text(data.count);
            })
            .catch(error => {
                console.error('Error checking pending payments:', error);
            });
    },

    initDataTables: function() {
        $('.table-responsive table').each(function() {
            if (!$.fn.DataTable.isDataTable(this)) {
                $(this).DataTable({
                    responsive: true,
                    pageLength: 10,
                    lengthMenu: [5, 10, 25, 50, 100],
                    scrollX: true
                });
            }
        });
    },

    switchTab: function(tabId) {
        // Update active tab
        $('.tab').removeClass('active');
        $(`.tab[data-tab="${tabId}"]`).addClass('active');

        // Update active tab content
        $('.tab-content').removeClass('active');
        $(`#${tabId}-tab`).addClass('active');
    },

    openModal: function(modalId) {
        $(`#${modalId}-modal`).css('display', 'flex');
        $('body').css('overflow', 'hidden');
    },

    closeModal: function(modalId) {
        $(`#${modalId}-modal`).hide();
        $('body').css('overflow', '');
    },

    // Edit functions
    editDrawing: function(id, amount, description) {
        $('#edit-drawing-id').val(id);
        $('#edit-drawing-amount').val(amount);
        $('#edit-drawing-description').val(description);
        $('#edit-drawing-form').attr('action', `/admin/update_drawing/${id}`);
        this.openModal('edit-drawing');
    },

    editBill: function(id, type, amount, dueDate, description) {
        $('#edit-bill-id').val(id);
        $('#edit-bill-type').val(type);
        $('#edit-bill-amount').val(amount);
        $('#edit-bill-due-date').val(dueDate);
        $('#edit-bill-description').val(description);
        $('#edit-bill-form').attr('action', `/admin/update_bill/${id}`);
        this.openModal('edit-bill');
    },

    payBill: function(id, type, amount) {
        $('#pay-bill-id').val(id);
        $('#pay-bill-type-display').text(type);
        $('#pay-bill-amount-display').text(moneyManagement.formatCurrency(amount));
        $('#pay-bill-form').attr('action', `/admin/pay_bill/${id}`);
        this.openModal('pay-bill');
    },

    editPurchase: function(id, type, amount, date, supplier, description) {
        $('#edit-purchase-id').val(id);
        $('#edit-purchase-type').val(type);
        $('#edit-purchase-amount').val(amount);
        $('#edit-purchase-date').val(date);
        $('#edit-purchase-supplier').val(supplier);
        $('#edit-purchase-description').val(description);
        $('#edit-purchase-form').attr('action', `/admin/update_purchase/${id}`);
        this.openModal('edit-purchase');
    },

    editPayroll: function(id, employeeId, amount, date, period, notes) {
        $('#edit-payroll-id').val(id);
        $('#edit-payroll-employee').val(employeeId);
        $('#edit-payroll-amount').val(amount);
        $('#edit-payroll-date').val(date);
        $('#edit-payroll-period').val(period);
        $('#edit-payroll-notes').val(notes);
        $('#edit-payroll-form').attr('action', `/admin/update_payroll/${id}`);
        this.openModal('edit-payroll');
    },

    editDebtor: function(id, name, contact, email, totalDebt, amountPaid, amountOwed, lastPaymentDate, nextPaymentDate, notes) {
        $('#edit-debtor-id').val(id);
        $('#edit-debtor-name').val(name);
        $('#edit-debtor-contact').val(contact || '');
        $('#edit-debtor-email').val(email || '');
        $('#edit-total-debt').val(totalDebt);
        $('#edit-amount-paid-display').text(moneyManagement.formatCurrency(amountPaid));
        $('#edit-amount-owed-display').text(moneyManagement.formatCurrency(amountOwed));
        $('#edit-last-payment-date').val(lastPaymentDate || '');
        $('#edit-next-payment-date').val(nextPaymentDate || '');
        $('#edit-debtor-notes').val(notes || '');
        $('#edit-debtor-form').attr('action', `/admin/update_debtor/${id}`);
        this.openModal('edit-debtor');
    },

    addDebtorPayment: function(id, name, totalDebt, amountPaid, amountOwed, nextPaymentDate) {
        $('#debtor-payment-id').val(id);
        $('#debtor-payment-name').text(name);
        $('#debtor-total-debt-display').text(moneyManagement.formatCurrency(totalDebt));
        $('#debtor-amount-paid-display').text(moneyManagement.formatCurrency(amountPaid));
        $('#debtor-amount-owed-display').text(moneyManagement.formatCurrency(amountOwed));
        
        // Set max payment amount
        $('#payment-amount').attr('max', amountOwed);
        $('#payment-amount').val(amountOwed > 0 ? amountOwed.toFixed(2) : '0.00');
        
        // Set default payment date to today
        $('#payment-date').val(new Date().toISOString().split('T')[0]);
        
        $('#add-debtor-payment-form').attr('action', `/admin/add_debtor_payment/${id}`);
        this.openModal('add-debtor-payment');
    },

    confirmDeleteRecord: function(id, type) {
        $('#delete-record-id').val(id);
        $('#delete-record-type').val(type);
        
        let message = '';
        switch(type) {
            case 'drawing': message = 'Are you sure you want to delete this drawing?'; break;
            case 'bill': message = 'Are you sure you want to delete this bill?'; break;
            case 'purchase': message = 'Are you sure you want to delete this purchase?'; break;
            case 'payroll': message = 'Are you sure you want to delete this payroll record?'; break;
            case 'debtor': message = 'Are you sure you want to delete this debtor? Payments and transactions will NOT be deleted.'; break;
            default: message = 'Are you sure you want to delete this record?';
        }
        
        $('#delete-confirm-message').text(message);
        $('#delete-form').attr('action', `/admin/delete_${type}/${id}`);
        this.openModal('delete-confirm');
    },

    confirmDelete: function() {
        const form = document.getElementById('delete-form');
        const action = form.getAttribute('action');
        const formData = new FormData(form);
        const headers = {};
        const token = moneyManagement.getCSRFToken();
        if (token) headers['X-CSRFToken'] = token;
        fetch(action, { method: 'POST', body: formData, headers })
            .then(r => r.json())
            .then(data => {
                if (data.success) {
                    moneyManagement.closeModal('delete-confirm');
                    moneyManagement.showAlert('success', 'Record deleted successfully');
                    moneyManagement.refreshAllData();
                } else {
                    moneyManagement.showAlert('danger', data.error || 'Failed to delete record');
                }
            })
            .catch(err => {
                console.error(err);
                moneyManagement.showAlert('danger', 'An error occurred while deleting the record');
            });
    },

    formatCurrency: function(amount) {
        return 'Ksh ' + parseFloat(amount).toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ",");
    },
    getCSRFToken: function() {
        const meta = document.querySelector('meta[name="csrf-token"]');
        if (meta && meta.content) return meta.content;
        const match = document.cookie.match(/(?:^|; )csrf_token=([^;]*)/);
        if (match) return decodeURIComponent(match[1]);
        const alt = document.cookie.match(/(?:^|; )csrf-access-token=([^;]*)/);
        return alt ? decodeURIComponent(alt[1]) : null;
    },
    showAlert: function(type, message) {
        const container = document.getElementById('alert-container');
        if (!container) return alert(message);
        const div = document.createElement('div');
        div.className = `alert alert-${type}`;
        div.innerHTML = `${message} <button class="close-alert">&times;</button>`;
        container.prepend(div);
        setTimeout(() => {
            if (div && div.parentNode) div.parentNode.removeChild(div);
        }, 4000);
    }
};

// Initialize when DOM is ready
$(document).ready(function() {
    moneyManagement.init();
});
</script>

<style>
    /* Money Management Specific Styles */
    .money-management-container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
        background-color: #f9f9f9;
        border-radius: 10px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    }

    .header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
        padding-bottom: 15px;
        border-bottom: 1px solid #e1e1e1;
    }

    .header h1 {
        color: #2c3e50;
        font-size: 24px;
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .current-date {
        background-color: #e8f4fd;
        padding: 8px 15px;
        border-radius: 20px;
        font-size: 14px;
        color: #3498db;
    }

    .summary-cards {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
    }

    .summary-card {
        background: #fff;
        border-radius: 10px;
        padding: 20px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        text-align: center;
        transition: transform 0.3s ease;
        border-top: 4px solid #3498db;
    }

    .summary-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.1);
    }

    .summary-card.income {
        border-top-color: #27ae60;
    }

    .summary-card.expenses {
        border-top-color: #e74c3c;
    }

    .summary-card.profit {
        border-top-color: #3498db;
    }

    .summary-card.pending {
        border-top-color: #f39c12;
    }

    .summary-card h3 {
        color: #7f8c8d;
        margin-bottom: 10px;
        font-size: 16px;
    }

    .summary-card .amount {
        font-size: 24px;
        font-weight: bold;
        margin-bottom: 5px;
    }

    .income .amount {
        color: #27ae60;
    }

    .expenses .amount {
        color: #e74c3c;
    }

    .profit .amount {
        color: #3498db;
    }

    .pending .amount {
        color: #f39c12;
    }

    .summary-card p {
        color: #95a5a6;
        font-size: 14px;
        margin: 0;
    }

    .tabs {
        display: flex;
        margin-bottom: 20px;
        border-bottom: 1px solid #e1e1e1;
        overflow-x: auto;
    }

    .tab {
        padding: 12px 20px;
        cursor: pointer;
        border-bottom: 3px solid transparent;
        transition: all 0.3s ease;
        font-weight: 500;
        color: #7f8c8d;
        white-space: nowrap;
    }

    .tab.active {
        border-bottom: 3px solid #3498db;
        color: #3498db;
        font-weight: 600;
    }

    .tab:hover:not(.active) {
        background-color: #f5f5f5;
    }

    .tab-content {
        display: none;
        animation: fadeIn 0.3s ease;
    }

    .tab-content.active {
        display: block;
    }

    .section-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
    }

    .section-header h2 {
        color: #2c3e50;
        font-size: 20px;
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .btn {
        padding: 10px 20px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-weight: 500;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .btn-primary {
        background-color: #3498db;
        color: white;
    }

    .btn-primary:hover {
        background-color: #2980b9;
    }

    .btn-danger {
        background-color: #e74c3c;
        color: white;
    }

    .btn-danger:hover {
        background-color: #c0392b;
    }

    .btn-success {
        background-color: #2ecc71;
        color: white;
    }

    .btn-success:hover {
        background-color: #27ae60;
    }

    .table-responsive {
        overflow-x: auto;
        margin-bottom: 20px;
        background-color: white;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        border-radius: 8px;
    }

    table {
        width: 100%;
        border-collapse: collapse;
    }

    th, td {
        padding: 12px 15px;
        text-align: left;
        border-bottom: 1px solid #f0f0f0;
    }

    th {
        background-color: #3498db;
        color: white;
        font-weight: 500;
    }

    tr:nth-child(even) {
        background-color: #f9f9f9;
    }

    tr:hover {
        background-color: #f1f1f1;
    }

    .status-pending {
        color: #f39c12;
        font-weight: bold;
    }

    .status-paid {
        color: #2ecc71;
        font-weight: bold;
    }

    .action-btns {
        display: flex;
        gap: 5px;
    }

    .action-btn {
        padding: 6px 10px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 14px;
        display: flex;
        align-items: center;
        justify-content: center;
        width: 30px;
        height: 30px;
    }

    .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        z-index: 1000;
        justify-content: center;
        align-items: center;
    }

    .modal-content {
        background-color: white;
        padding: 20px;
        border-radius: 10px;
        width: 90%;
        max-width: 500px;
        max-height: 90vh;
        overflow-y: auto;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
    }

    .modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
        padding-bottom: 10px;
        border-bottom: 1px solid #e1e1e1;
    }

    .modal-header h2 {
        color: #3498db;
    }

    .close-btn {
        background: none;
        border: none;
        font-size: 1.5rem;
        cursor: pointer;
        color: #7f8c8d;
    }

    .form-group {
        margin-bottom: 15px;
    }

    .form-group label {
        display: block;
        margin-bottom: 5px;
        font-weight: 500;
        color: #2c3e50;
    }

    .form-group input,
    .form-group select,
    .form-group textarea {
        width: 100%;
        padding: 10px;
        border: 1px solid #ddd;
        border-radius: 5px;
        font-size: 1rem;
    }

    .form-group textarea {
        min-height: 100px;
        resize: vertical;
    }

    .form-actions {
        display: flex;
        justify-content: flex-end;
        gap: 10px;
        margin-top: 20px;
    }

    .alert {
        padding: 10px 15px;
        border-radius: 5px;
        margin-bottom: 20px;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .alert-success {
        background-color: #d4edda;
        color: #155724;
        border: 1px solid #c3e6cb;
    }

    .alert-danger {
        background-color: #f8d7da;
        color: #721c24;
        border: 1px solid #f5c6cb;
    }

    .alert-warning {
        background-color: #fff3cd;
        color: #856404;
        border: 1px solid #ffeeba;
    }

    .close-alert {
        background: none;
        border: none;
        font-size: 1.2rem;
        cursor: pointer;
        color: inherit;
    }

    .empty-state {
        text-align: center;
        padding: 40px 20px;
        color: #7f8c8d;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
    }

    .empty-state i {
        font-size: 3rem;
        color: #bdc3c7;
        margin-bottom: 15px;
    }

    @media (max-width: 768px) {
        .summary-cards {
            grid-template-columns: 1fr;
        }

        .section-header {
            flex-direction: column;
            align-items: flex-start;
            gap: 10px;
        }

        .header {
            flex-direction: column;
            align-items: flex-start;
            gap: 10px;
        }
    }

    @keyframes fadeIn {
        from { opacity: 0; }
        to { opacity: 1; }
    }
</style>

{% endblock %}