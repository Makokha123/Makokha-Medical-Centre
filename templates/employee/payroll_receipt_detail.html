{% extends "base.html" %}

{% block content %}
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="{{ request.script_root }}/vendor/cdnjs/ajax/libs/font-awesome/6.4.0/css/all.min.css" onerror="this.onerror=null;this.href='https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css';">

<div class="receipt-container">
    {% if request.args.get('print') %}
        <div class="no-print">
            <button class="btn btn-primary btn-print" onclick="window.print()">
                <i class="fas fa-print"></i> Print Receipt
            </button>
            <a href="{{ url_for('view_payroll_receipt', receipt_id=receipt.id) }}" class="btn btn-secondary">
                <i class="fas fa-times"></i> Close
            </a>
        </div>
    {% else %}
        <div class="no-print">
            <a href="{{ url_for('view_my_payroll_receipts') }}" class="btn btn-secondary">
                <i class="fas fa-arrow-left"></i> Back to Receipts
            </a>
            <button class="btn btn-primary btn-print" onclick="window.print()">
                <i class="fas fa-print"></i> Print
            </button>
            <a href="{{ url_for('download_payroll_receipt_employee', receipt_id=receipt.id) }}" class="btn btn-success">
                <i class="fas fa-download"></i> Download PDF
            </a>
        </div>
    {% endif %}

    <div class="receipt-content">
        <!-- Receipt Header -->
        <div class="receipt-header">
            <div class="company-info">
                <h2><i class="fas fa-hospital"></i> Makokha Medical Centre</h2>
                <p>Payroll Department</p>
            </div>
            <div class="receipt-title">
                <h1>PAYMENT RECEIPT</h1>
            </div>
            <div class="receipt-meta">
                <div class="meta-item">
                    <span class="label">Receipt #:</span>
                    <span class="value">{{ receipt.receipt_number }}</span>
                </div>
                <div class="meta-item">
                    <span class="label">Date:</span>
                    <span class="value">{{ receipt.payment_date.strftime('%d %B %Y') }}</span>
                </div>
                <div class="meta-item">
                    <span class="label">Time:</span>
                    <span class="value">{{ receipt.payment_date.strftime('%H:%M') }}</span>
                </div>
            </div>
        </div>

        <!-- Employee Information Section -->
        <div class="info-section">
            <h3>Employee Information</h3>
            <div class="info-grid">
                <div class="info-item">
                    <span class="info-label">Name:</span>
                    <span class="info-value">{{ employee.name }}</span>
                </div>
                <div class="info-item">
                    <span class="info-label">Employee ID:</span>
                    <span class="info-value">{{ employee.id }}</span>
                </div>
                <div class="info-item">
                    <span class="info-label">Position:</span>
                    <span class="info-value">{{ employee.position or 'N/A' }}</span>
                </div>
                <div class="info-item">
                    <span class="info-label">Hire Date:</span>
                    <span class="info-value">{{ payroll.hired_date.strftime('%d %B %Y') if payroll.hired_date else 'N/A' }}</span>
                </div>
            </div>
        </div>

        <!-- Payment Details Section -->
        <div class="payment-section">
            <h3>Payment Details</h3>
            
            <table class="payment-table">
                <thead>
                    <tr>
                        <th>Description</th>
                        <th class="amount">Amount (Ksh)</th>
                    </tr>
                </thead>
                <tbody>
                    <tr class="salary-row">
                        <td class="description">Base Salary</td>
                        <td class="amount">{{ "%.2f"|format(receipt.salary) }}</td>
                    </tr>
                    <tr>
                        <td class="description">Previous Amount Paid</td>
                        <td class="amount">{{ "%.2f"|format(receipt.previous_amount_paid) }}</td>
                    </tr>
                    <tr class="separator"></tr>
                    <tr class="highlight-row">
                        <td class="description"><strong>Current Payment</strong></td>
                        <td class="amount"><strong>{{ "%.2f"|format(receipt.amount) }}</strong></td>
                    </tr>
                    <tr class="separator"></tr>
                    <tr class="total-row">
                        <td class="description"><strong>Total Amount Paid</strong></td>
                        <td class="amount total-amount"><strong>{{ "%.2f"|format(receipt.current_amount_paid) }}</strong></td>
                    </tr>
                    <tr class="separator"></tr>
                    <tr class="arrears-row {% if receipt.arrears > 0 %}arrears-due{% elif receipt.arrears < 0 %}overpaid{% else %}fully-paid{% endif %}">
                        <td class="description"><strong>Remaining Arrears</strong></td>
                        <td class="amount">
                            <strong>
                                {% if receipt.arrears > 0 %}
                                    Ksh {{ "%.2f"|format(receipt.arrears) }}
                                    <span class="status">(Outstanding)</span>
                                {% elif receipt.arrears < 0 %}
                                    (Overpaid: Ksh {{ "%.2f"|format(abs(receipt.arrears)) }})
                                    <span class="status">(Credit)</span>
                                {% else %}
                                    Ksh 0.00
                                    <span class="status">(Fully Paid)</span>
                                {% endif %}
                            </strong>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- Payroll Period Section -->
        <div class="info-section">
            <h3>Payroll Period Information</h3>
            <div class="info-grid">
                <div class="info-item">
                    <span class="info-label">Pay Period:</span>
                    <span class="info-value">{{ payroll.pay_period|title }}</span>
                </div>
                <div class="info-item">
                    <span class="info-label">Payment Date:</span>
                    <span class="info-value">{{ payroll.payment_date.strftime('%d %B %Y') }}</span>
                </div>
                <div class="info-item">
                    <span class="info-label">Status:</span>
                    <span class="info-value">
                        {% if receipt.arrears > 0 %}
                            <span class="badge-status outstanding">Outstanding</span>
                        {% elif receipt.arrears < 0 %}
                            <span class="badge-status overpaid">Overpaid</span>
                        {% else %}
                            <span class="badge-status paid">Fully Paid</span>
                        {% endif %}
                    </span>
                </div>
            </div>
        </div>

        <!-- Notes Section -->
        {% if receipt.notes %}
            <div class="notes-section">
                <h3>Notes</h3>
                <div class="notes-content">
                    {{ receipt.notes }}
                </div>
            </div>
        {% endif %}

        <!-- Issued By Section -->
        <div class="issued-section">
            <div class="issued-info">
                <p><strong>Issued By:</strong> {{ issued_user.username if issued_user else 'System' }}</p>
                <p><strong>Issued On:</strong> {{ receipt.created_at.strftime('%d %B %Y at %H:%M') }}</p>
            </div>
        </div>

        <!-- Footer -->
        <div class="receipt-footer">
            <p>This is an electronically generated receipt. No signature is required.</p>
            <p><small>For inquiries or discrepancies, please contact the HR/Payroll Department</small></p>
        </div>
    </div>

    {% if not request.args.get('print') %}
        <div class="no-print action-buttons-bottom">
            <a href="{{ url_for('view_my_payroll_receipts') }}" class="btn btn-secondary">
                <i class="fas fa-arrow-left"></i> Back to Receipts
            </a>
            <button class="btn btn-primary" onclick="window.print()">
                <i class="fas fa-print"></i> Print Receipt
            </button>
            <a href="{{ url_for('download_payroll_receipt_employee', receipt_id=receipt.id) }}" class="btn btn-success">
                <i class="fas fa-download"></i> Download PDF
            </a>
        </div>
    {% endif %}
</div>

<style>
:root {
    --primary: #667eea;
    --secondary: #6c757d;
    --success: #28a745;
    --danger: #dc3545;
    --warning: #ffc107;
    --gray-200: #e9ecef;
    --gray-300: #dee2e6;
    --gray-600: #6c757d;
    --white: #ffffff;
    --dark: #343a40;
}

* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    background: #f5f7fa;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
}

.receipt-container {
    max-width: 900px;
    margin: 0 auto;
    padding: 20px;
}

.no-print {
    margin-bottom: 20px;
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
}

.btn {
    padding: 10px 20px;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    text-decoration: none;
    font-size: 14px;
    transition: all 0.3s ease;
    display: inline-flex;
    align-items: center;
    gap: 8px;
}

.btn-primary {
    background: var(--primary);
    color: white;
}

.btn-primary:hover {
    background: #5568d3;
    color: white;
}

.btn-secondary {
    background: var(--secondary);
    color: white;
}

.btn-secondary:hover {
    background: #5a6268;
    color: white;
}

.btn-success {
    background: var(--success);
    color: white;
}

.btn-success:hover {
    background: #218838;
    color: white;
}

.btn-print {
    background: var(--primary);
    color: white;
}

.btn-print:hover {
    background: #5568d3;
    color: white;
}

.receipt-content {
    background: var(--white);
    border: 1px solid var(--gray-300);
    border-radius: 8px;
    padding: 40px;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    page-break-after: always;
}

.receipt-header {
    text-align: center;
    margin-bottom: 40px;
    padding-bottom: 20px;
    border-bottom: 2px solid var(--primary);
}

.company-info h2 {
    color: var(--primary);
    margin-bottom: 5px;
    font-size: 24px;
}

.company-info p {
    color: var(--gray-600);
    font-size: 14px;
}

.receipt-title h1 {
    color: var(--dark);
    font-size: 28px;
    margin: 15px 0;
    text-transform: uppercase;
    letter-spacing: 2px;
}

.receipt-meta {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 20px;
    margin-top: 20px;
    text-align: left;
}

.meta-item {
    background: #f8f9fa;
    padding: 10px;
    border-radius: 4px;
}

.meta-item .label {
    display: block;
    font-weight: 600;
    color: var(--dark);
    font-size: 12px;
    text-transform: uppercase;
}

.meta-item .value {
    display: block;
    color: var(--primary);
    font-weight: 700;
    font-size: 16px;
    margin-top: 5px;
}

.info-section {
    margin-bottom: 30px;
}

.info-section h3 {
    color: var(--dark);
    font-size: 16px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 1px;
    margin-bottom: 15px;
    padding-bottom: 10px;
    border-bottom: 2px solid var(--gray-200);
}

.info-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 20px;
}

.info-item {
    background: #f8f9fa;
    padding: 15px;
    border-radius: 4px;
    border-left: 4px solid var(--primary);
}

.info-label {
    display: block;
    font-weight: 600;
    color: var(--gray-600);
    font-size: 12px;
    text-transform: uppercase;
    margin-bottom: 5px;
}

.info-value {
    display: block;
    color: var(--dark);
    font-size: 14px;
    font-weight: 500;
}

.payment-section {
    margin-bottom: 30px;
}

.payment-section h3 {
    color: var(--dark);
    font-size: 16px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 1px;
    margin-bottom: 15px;
    padding-bottom: 10px;
    border-bottom: 2px solid var(--gray-200);
}

.payment-table {
    width: 100%;
    border-collapse: collapse;
    margin-bottom: 20px;
}

.payment-table thead {
    background: linear-gradient(135deg, var(--primary), #764ba2);
    color: white;
}

.payment-table th {
    padding: 12px;
    text-align: left;
    font-weight: 600;
    font-size: 13px;
    text-transform: uppercase;
}

.payment-table th.amount {
    text-align: right;
}

.payment-table td {
    padding: 12px;
    border-bottom: 1px solid var(--gray-300);
}

.payment-table td.description {
    text-align: left;
    color: var(--dark);
}

.payment-table td.amount {
    text-align: right;
    color: var(--dark);
    font-weight: 500;
    font-family: 'Courier New', monospace;
}

.salary-row {
    background: #f8f9fa;
    font-weight: 600;
}

.separator {
    height: 2px;
    background: var(--gray-200);
    border: none;
}

.separator td {
    border: none;
    padding: 0;
}

.highlight-row {
    background: #fff3cd;
    font-weight: 600;
}

.total-row {
    background: linear-gradient(135deg, rgba(102, 126, 234, 0.1), rgba(118, 75, 162, 0.1));
    font-size: 16px;
}

.total-amount {
    color: var(--primary) !important;
    font-size: 18px !important;
}

.arrears-row {
    font-size: 16px;
    font-weight: 600;
}

.arrears-row.arrears-due {
    background: #f8d7da;
    color: #721c24;
}

.arrears-row.arrears-due td {
    color: #721c24;
    border-color: #f5c6cb;
}

.arrears-row.fully-paid {
    background: #d4edda;
    color: #155724;
}

.arrears-row.fully-paid td {
    color: #155724;
    border-color: #c3e6cb;
}

.arrears-row.overpaid {
    background: #fff3cd;
    color: #856404;
}

.arrears-row.overpaid td {
    color: #856404;
    border-color: #ffeeba;
}

.status {
    display: block;
    font-size: 12px;
    margin-top: 5px;
    font-weight: 400;
    text-transform: uppercase;
}

.badge-status {
    display: inline-block;
    padding: 6px 12px;
    border-radius: 20px;
    font-size: 12px;
    font-weight: 600;
    text-transform: uppercase;
}

.badge-status.outstanding {
    background: #f8d7da;
    color: #721c24;
}

.badge-status.paid {
    background: #d4edda;
    color: #155724;
}

.badge-status.overpaid {
    background: #fff3cd;
    color: #856404;
}

.notes-section {
    margin-bottom: 30px;
    background: #f8f9fa;
    padding: 20px;
    border-radius: 4px;
    border-left: 4px solid var(--warning);
}

.notes-section h3 {
    border: none;
    padding: 0;
    margin: 0 0 10px 0;
    font-size: 14px;
    text-transform: uppercase;
}

.notes-content {
    color: var(--dark);
    font-size: 14px;
    line-height: 1.6;
}

.issued-section {
    background: #f8f9fa;
    padding: 20px;
    border-radius: 4px;
    margin-bottom: 20px;
}

.issued-info p {
    margin: 5px 0;
    color: var(--dark);
    font-size: 14px;
}

.issued-info p strong {
    color: var(--primary);
}

.receipt-footer {
    text-align: center;
    padding: 20px 0;
    border-top: 1px solid var(--gray-300);
    color: var(--gray-600);
    font-size: 12px;
}

.receipt-footer p {
    margin: 5px 0;
}

.action-buttons-bottom {
    margin-top: 20px;
    justify-content: center;
}

@media (min-width: 320px) and (max-width: 480px) {
    .receipt-content {
        padding: 20px;
    }

    .receipt-meta {
        grid-template-columns: 1fr;
    }

    .info-grid {
        grid-template-columns: 1fr;
    }

    .payment-table {
        font-size: 13px;
    }

    .payment-table th,
    .payment-table td {
        padding: 8px;
    }
}

@media print {
    body {
        background: white;
    }

    .receipt-container {
        padding: 0;
    }

    .no-print {
        display: none !important;
    }

    .receipt-content {
        box-shadow: none;
        border: none;
        page-break-after: always;
    }
}
</style>
{% endblock %}
